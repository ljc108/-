# STM32-zhinengjiaju-mqtt
# 主要步骤：

###  1、硬件选型
STM32F103ZET6（正点原子精英板）、BH1750光照度传感器、DHT11温湿度传感器、OLED屏（I2C接口）、ESP8266-01s WIFI模块。
  
###  2、代码工程移植
移植正点原子的点亮LED的工程文件或者使用STM32CubMX生成，后在点亮LED的文件基础之上移植外设驱动的代码（DHT11驱动代码、
  BH1750驱动代码、OLED（I2C）驱动代码）。

###  3、Main文件编写
  实现温湿度光照度传感器采集（分别获取数据），**DHT11刚开始收到数据为0，因为有一个初始化的过程，即启动缓冲时间（大概为1s），
  后收到的数据就是正常温湿度。** 初始化DHT11、BH1750、OLED、延时函数、USART、定时器、蜂鸣器、外部中断。OLED数据显示（第一
  行Welcome、第二行温度、第三行湿度、第四行光照度）**<利用定时器中断驱动OLED>**。
  **若温度>30℃或湿度>80%或光照强度>10000Lx则报警**，利用外部中断来编写按键控制程序。当蜂鸣器报警后，若按下按键则停止报警，
  但是如果还是超过阈值的条件下，过10s后继续报警。

###  4、设备端上行采集数据到MQTT服务器实现
  初始化ESP8266、接入onenet，定义WIFI名称和密码（WIFI就是电脑连接的），接入在线MQTT服务器 **（写MQTT的域名和TCP端口）**。
  连接上MQTT，给MQTT发送数据，MQTT接收到温湿度和光照度数据。

###  5、设备端接收MQTT服务器下发命令并执行实现
  下发JSON格式命令形如：{"LED_SW":1}  开灯

  JSON文件：  {"key":value}  key字符串  value任意类型的

  {
  
      "姓名": "张三",
      
      "年龄": 18
      
  }

  收到{"LED_SW":0}  关灯
  
###  6、上位机软件编写（微信小程序）
  UI底栏开发+UI头部开发+UI数据部分开发+连接MQTT服务器并订阅消息+订阅消息处理+数据与UI视图绑定+下发命令到服务器

  最后进行硬件端与小程序联调

  **UI图标在阿里巴巴矢量图标**

  利用微信开放文档里的小程序配置进行编写

  订阅消息处理MQTT Web端发送数据（JSON），微信开发者工具内能够收到，并且在微信小程序显示
